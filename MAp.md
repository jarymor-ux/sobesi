### Что такое мапа?

**Мапа (Map)** — это коллекция пар "ключ-значение", где каждый ключ уникален и связывается с определённым значением. Мапа позволяет эффективно добавлять, удалять и искать элементы по ключу.

---

### Как устроена мапа под капотом?

Под капотом мапа обычно реализована как **хэш-таблица**. Основные компоненты:

1. **Бакеты (buckets):** Массив ячеек, каждая из которых хранит несколько пар "ключ-значение".
2. **Хэш-функция:** Преобразует ключ в индекс бакета.
3. **Разрешение коллизий:** Если два ключа попадают в один бакет (коллизия), применяется цепочка (linked list) или открытая адресация.

Механизм работы:

- При добавлении вычисляется хэш ключа, который указывает на бакет.
- Если бакет занят, элементы группируются в цепочку.
- При превышении порога заполненности (load factor) происходит **рехеширование**, то есть перераспределение элементов в более крупный массив бакетов.

---

### Какие ключи могут быть у мапы?

Ключи мапы должны быть **сравнимыми (comparable)**, чтобы гарантировать их уникальность и корректность работы. В Go это:

- Примитивные типы: `int`, `float`, `string`, `bool`.
- Указатели.
- Структуры (если все поля сравнимы).
- Типы, которые можно использовать с оператором `==`.

---

### Map и concurrency

#### Что произойдет при конкурентной записи в мапу?

Если две или более горутины одновременно читают или пишут в мапу без синхронизации, это приведёт к **панике (runtime error)**. Мапы в Go по умолчанию **не потокобезопасны**.

#### Как работает эвакуация данных?

Эвакуация данных происходит при рехешировании:

- Создаётся новый массив бакетов.
- Элементы из старых бакетов перераспределяются в новые бакеты на основе нового размера таблицы.

#### Потокобезопасная ли мапа?

Обычная мапа в Go **не потокобезопасна**. Для потокобезопасного использования необходимо:

- Использовать `sync.Mutex` или `sync.RWMutex` для синхронизации доступа.
- Применять специализированную структуру, такую как `sync.Map`.

#### Map vs Sync.Map

- **`map`:** Универсальный тип. Не потокобезопасен.
- **`sync.Map`:** Потокобезопасен, оптимизирован для сценариев редкого обновления и частого чтения. Использует внутреннюю оптимизацию для минимизации блокировок.

---

### Какая сложность работы с мапой?

- **Поиск, добавление, удаление:** O(1) в среднем случае благодаря хэш-функции.
- **Худший случай:** O(n) (при большой нагрузке или плохой хэш-функции, из-за коллизий).

---

### Можно ли взять адрес элемента мапы и почему?

Нельзя. В Go нельзя напрямую получить адрес элемента мапы, так как:

- Элементы мапы могут перемещаться в памяти при рехешировании.
- Это нарушает безопасность памяти и может привести к некорректным ссылкам.